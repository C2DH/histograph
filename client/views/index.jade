html
  head
    title!= title
    
    link(href='/css/bootstrap.min.css', rel='stylesheet')
    link(href='/css/font-awesome.min.css', rel='stylesheet')
    link(href='/css/perfect-scrollbar.min.css', rel='stylesheet')
    link(href='/css/annotator.css', rel='stylesheet')
    link(href='/css/annotorious.css', rel='stylesheet')
    link(href='/css/codemirror.css', rel='stylesheet')
      
    link(href='/css/style.css', rel='stylesheet')
  
    script(src='/socket.io/socket.io.js')
    script(src='//use.typekit.net/fwe7tir.js')

    script.
      try{Typekit.load();}catch(e){}



  body(ng-app='histograph')
    script(type='text/javascript').
      var socket = io();
    
    script(type='text/ng-template', id='suggest.html').
      <div>
        <a ng-href='/#/{{match.model.props.type_search=="resource" ? "r": "e"}}/{{match.model.id}}'>
          {{match.model.props | title: 'en'}}
        </a>
        <span ng-click='$parent.$parent.$parent.$parent.queue(match.model.id, true)'>
          <i class='fa fa-play-circle-o'></i>
        </span>
      </div>

    div(ng-controller='CoreCtrl')
      if user.username
        header 
        
           
          
          div(class='row', ng-cloak)
            div(class='col-sm-4')
              a(href='#/') hg v.0.1
              a(href='#/profile')
                img(src=user.picture)
                span {{user.username}} 
                
             
              div(class='inline', dropdown, dropdown-append-to-body='true', is-open='status.isopen')
                span(dropdown-toggle, ng-disabled='disabled')
                  {{ language }}
                  i(class='fa fa-down')
      
                ul(class='dropdown-menu', role='menu', )
                  li(ng-repeat='lang in availableLanguages', ng-click='setLanguage(lang)') {{lang}}
                
                
                
                
            div(class='col-sm-4')
              div(id='search-field')
                form(ng-submit='setQuery(query)')
                  div(class='input-group')
                    input(type='text', ng-model='query', class='form-control', placeholder='Search for...', typeahead='item for items in suggest($viewValue)', typeahead-wait-ms='200', typeahead-template-url='suggest.html')
                    //- input(type='text', ng-model='query', class='form-control', placeholder='Search for...', bs-typeahead, bs-options='item for items in suggest($viewValue)', data-container='body',data-delay='{ show: 500, hide: 1000000 }')
                    span(class='input-group-btn')
                      a(class='btn btn-default', type='button', ng-href='/#/search/{{query}}') search
            div(class='col-sm-2')
              a(href='#')
                span settings 
            div(class='col-sm-2')
              a(href='/logout')
                span logout
          div(id='history')
            div(history='', trails='trails')
          
      if !user.username
          div(id='login')
            div(id='logo') hg
            h5 welcome to histograph
            form
              div(class="btn-group-vertical", role="group")
                a(ng-href='/auth/twitter?next={{locationPath}}', class='btn btn-default') login with twitter
                a(ng-href='/auth/google?next={{locationPath}}', class='btn btn-default') login with google plus
      else
        div(class='view {{currentCtrl}} {{queueStatus}}')
          div(ng-view, autoscroll='true')
        
        
          //- div(id='see-also', class='{{currentCtrl}}', ng-cloak)
          //-   h3 {{headers.seealso}}
          //-   //- pagination(boundary-links='true', total-items='relatedCount || 0' ng-model='relatedPage' class='pagination-sm' previous-text='<' next-text='>' first-text='<<' last-text='>>')
          //-   //- change header of the see-also section.
          //-   div(ng-if="currentCtrl == 'InquiryCreateCtrl'")
          //-     p new inquiry
          //-     form
          //-       div title
          //-       input(type='text', ng-model='inquiry.name', id='inquiry-name', class='tk-proxima-nova')
          //-       div content
          //-       div(ng-model='inquiry.description', ui-codemirror='{lineNumbers: false, lineWrapping : true, mode: "xml"}')
          //-       div(style='text-align:center')
          //-         div(class='btn-group', role='group', aria-label='...')
          //-           button(class='btn btn-primary', ng-click='createInquiry()') create inquiry
          //-   //- change header of the see-also section.
          //-   div(ng-if="currentCtrl == 'InquiryCtrl'")
          //-     p Main inquiry.
            
          //-   div(ng-repeat='relatedItem in relatedItems', class='related')
          //-     div(ng-if='relatedItem.type == "resource"')
          //-       h4
          //-         a(ng-href='#/r/{{relatedItem.id}}', ng-bind-html='relatedItem.props | title : language')
                  
          //-       div(class='actions')
          //-         button(class='btn btn-default action', tooltip='add to playlist', tooltip-append-to-body="true", ng-click='queue(relatedItem.id, true)')
          //-           i(class='fa fa-play-circle-o')
              
          //-       div
          //-         span(class='date') {{relatedItem.props|guessInterval}}
          //-         span(ng-if='relatedItem.persons', class='tags') â€” 
          //-           i in the document:
          //-           span(ng-repeat='per in relatedItem.persons', data-id='{{per.id}}', ng-click='toggleMenu($event, relatedItem, per)', class='tag person') {{per.name}}
                
          //-       img(ng-if='relatedItem.props.mimetype=="image"', ng-src="{{relatedItem.props | url : language}}")
          //-       blockquote {{relatedItem.props | abstract : language}}
                
          //-     div(ng-if='relatedItem.type == "inquiry"', ng-include='"templates/partials/inquiry-lite.html"')
            
          //-   div(ng-if="currentCtrl == 'InquiryCtrl'")
          //-     p new comment
          //-     form
          //-       div your answer
          //-       div(ng-model='comment.content', ui-codemirror='{lineNumbers: false, lineWrapping : true, mode: "xml"}')
          //-       div(style='text-align:center')
          //-         div(class='btn-group', role='group', aria-label='...')
          //-           button(class='btn btn-primary', ng-click='createObservation()') answer
              
        
        div(id='milkyway', sigma, graph='graph', tips='headers.graph', togglemenu='toggleMenu(e, item, tag)', class='{{currentCtrl}} {{queueStatus}}', controller='currentCtrl' redirect='redirect(path)')
          
        div(id='timeline', timeline, t='timeline', cxt='contextualTimeline')
          
        div(id='pop', popit, target="target", redirect='redirect(path)', comment="startCommenting(item, tag, hashtag)", queue="queue(item, inprog)")
          div(class='action-group')
            a(class=' action', title='visit', data-action='link', tooltip='visit entity page')
              span(class='fa fa-link')
            a(class=' action', title='vote up')
              span(class='fa fa-thumbs-o-down')
            a(class=' action queue', tooltip="add to your current playlist", data-action='queue')
              span(class='fa fa-play-circle-o')
            a(class=' action', title='comment', data-action='comment')
              span(class='fa fa-comment-o')
                
        div(id='inquirer', class="{{commenting? 'commenting': ''}}")
          div
            img(class='user-picture', ng-src='{{user.picture}}')
            p {{user.username}} {{comment.tags}}
          div(ng-model='comment.text', ui-codemirror="{lineNumbers: false,theme:'twilight',lineWrapping : true,mode: 'Smalltalk'}")
          div(style='text-align:center')
            div(class='btn-group', role='group', aria-label='...')
              button(class='btn btn-primary', ng-click='postComment()') comment
              button(ng-if='comment.tags.length' class='btn btn-default') signale
              button(class='btn btn-default', ng-click='stopCommenting()') close
        
        div(id='playlist', ng-class='queueStatus')
          div(id='playlist-resume', tooltip-append-to-body='true', tooltip='toggle read queue' ng-click='toggleQueue()')
            span(class="fa fa-angle-up")
          div(ng-if='playlist.length == 0') ... select some element to start playlist ...
          div(id='playlist-queue')
            div(id='playlist-queue-rail',perfect-scrollbar, use-both-wheel-axes='true',wheel-propagation="true", refresh-on-change="playlist", suppress-scroll-y="true", wheel-speed="20")
              div(class='playlist-item', ng-repeat='item in playlist')
                div(class='playlist-item-wrapper')
                  div(class='pic', ng-if='item.type == "person"')
                    a(ng-href='/#/e/{{item.id}}', tooltip-append-to-body='true', tooltip='visit person page')
                      img(ng-src='{{item.props.thumbnail}}', ng-if='item.props.thumbnail')
                  div(class='pic', ng-if='item.type == "location" || item.type == "place"')
                    a(ng-href='/#/e/{{item.id}}', tooltip-append-to-body='true', tooltip='visit location page')
                      
                  div(class='pic', ng-if='item.type == "resource"')
                    a(ng-href='/#/r/{{item.id}}', tooltip-append-to-body='true', tooltip='visit resource page')
                      img(ng-if='item.props.mimetype == "image" && item.props.url', ng-src='media/{{item.props.url}}')
                  h5(data-id='{{item.id}}', tooltip-append-to-body='true', tooltip='{{item.props | title : language }}') {{item.props | title : language : 24 }}
                  a(class='action', ng-click='removeFromQueue(item)', tooltip-append-to-body='true', tooltip='remove from this set')
                    i(class='fa fa-times-circle')
                
          div(id='playlist-actions', class='btn-group')
            a(ng-href='/#/ap/{{playlist | map:"id"}}', tooltip-append-to-body='true', tooltip='explore connections between your readlist', class='btn btn-primary')
              i(class='fa fa-diamond')
            a(ng-href='/#/neighbors/{{playlist | map:"id"}}', tooltip-append-to-body='true', tooltip='explore neighborhood of your readlist', class='btn btn-primary')
              i(class='fa fa-rocket')
            //- a(ng-href='/#/neighbors/{{playlist | map:"id"}}', tooltip-append-to-body='true', tooltip='save your readlist', class='btn btn-primary')
            //-   i(class='fa fa-save')
      
      div(id="loading", class="{{showSpinner? 'active': ''}}") loading ...
       
    script(src='/js/lib/jquery-2.1.3.min.js') 
    script(src='/js/lib/d3.min.js')  
    script(src='/js/lib/codemirror.js')
    script(src='/js/lib/codemirror-addon-simple.js')
    script(src='/js/lib/codemirror-addon-show-hint.js')
      
    script(src='/js/lib/annotator.min.js')
    script(src='/js/lib/annotorious.min.js')
    script(src='/js/lib/annotorious-merge.js')   
    script(src='/js/lib/marked.min.js')
    script(src='/js/lib/moment.min.js')
    script(src='/js/lib/sigma.min.js')
    script(src='/js/lib/sigma.layout.forceAtlas2.min.js')
    //- script(src='/js/lib/sigma.statistics.HITS.js')
    script(src='/js/lib/perfect-scrollbar.min.js')
    script(src='/js/lib/perfect-scrollbar.with-mousewheel.min.js')
    script(src='/js/lib/angular.min.js')
    script(src='/js/lib/angular-route.min.js')
    script(src='/js/lib/angular-resource.min.js')
    script(src='/js/lib/angular-cookies.min.js')
    
    script(src='/js/lib/ui-codemirror.min.js')
    
    script(src='/js/lib/angular-strap.min.js')
    script(src='/js/lib/angular-strap.tpl.min.js')
    script(src='/js/lib/ui-bootstrap-tpls.min.js')
    script(src='/js/lib/angular-perfect-scrollbar.js')
    
    script(src='/js/app.js')
    script(src='/js/services.js')
    script(src='/js/filters.js')
    
    script(src='/js/controllers/core.js')
    script(src='/js/controllers/index.js')
    script(src='/js/controllers/search.js')
    script(src='/js/controllers/resource.js')
    script(src='/js/controllers/inquiry.js')
    script(src='/js/controllers/entity.js')
    script(src='/js/controllers/collection.js')
    script(src='/js/controllers/all-shortest-paths.js')
    script(src='/js/controllers/neighbors.js')
    
    script(src='/js/directives/annotator.js') 
    script(src='/js/directives/annotorious.js') 
    script(src='/js/directives/sigma.js')   
    script(src='/js/directives/timeline.js')
    script(src='/js/directives/history.js')
    script(src='/js/directives/popit.js')
    script(src='/js/directives/lazy-text.js')
    